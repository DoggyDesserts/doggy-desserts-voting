<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Doggy Desserts - Monthly Competition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
    :root {
      --primary: #54b8b2;
      --secondary: #ab5896;
      --accent: #c0d969;
      --light: #f9f9f9;
      --dark: #333333;
    }
    body { font-family: 'Nunito', sans-serif; background-color: var(--light); }
    .dog-card { transition: all .3s ease; border:2px solid #f1f1f1; overflow:hidden; }
    .dog-card:hover { transform: translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,.1); }
    .heart-btn { transition: all .2s ease; cursor: pointer; }
    .heart-btn:hover:not(.voted) { transform: scale(1.1); }
    .heart-btn.voted { color: var(--secondary); animation: heartBeat .3s ease-in-out; }
    @keyframes heartBeat { 0%{transform:scale(1)}25%{transform:scale(1.3)}50%{transform:scale(1)}75%{transform:scale(1.2)}100%{transform:scale(1)} }
    .heart-animation { position:absolute; pointer-events:none; animation:floatUp 1s ease-out forwards; opacity:0; }
    @keyframes floatUp {0%{transform:translateY(0) scale(.5);opacity:1}100%{transform:translateY(-50px) scale(1.5);opacity:0}}
    .vote-count { transition: all .3s ease; }
    .vote-count.bump { animation: bump .3s ease; }
    @keyframes bump {0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
    .paw-print { position:absolute; opacity:.05; z-index:0; }
    .admin-panel { display:none; background:#fff; border:2px solid var(--primary); border-radius:8px; padding:20px; margin-bottom:30px; box-shadow:0 5px 15px rgba(0,0,0,0.1); position:relative; }
    .admin-toggle { position:fixed; bottom:20px; right:20px; z-index:100; background:var(--primary); color:#fff; border:none; border-radius:50%; width:50px; height:50px; font-size:24px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.2); }
    .dog-entry { display:flex; align-items:center; padding:10px; border-bottom:1px solid #eee; }
    .dog-entry:last-child { border-bottom:none; }
    .login-overlay { position:fixed; top:0;left:0;right:0;bottom:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:1000; }
    .login-panel { background:#fff; padding:30px; border-radius:8px; width:90%; max-width:400px; box-shadow:0 5px 20px rgba(0,0,0,0.2); }
    .logout-btn { position:absolute; top:20px; right:20px; background:#f3f4f6; color:#4b5563; border:1px solid #e5e7eb; border-radius:4px; padding:6px 12px; font-size:14px; cursor:pointer; transition:all .2s ease; }
    .logout-btn:hover { background:#e5e7eb; }
    .share-btn { display:flex; align-items:center; padding:5px 10px; background:#f3f4f6; border-radius:4px; color:#4b5563; font-size:14px; cursor:pointer; transition:all .2s ease; }
    .share-btn:hover { background:#e5e7eb; }
    .share-btn svg { margin-right:5px; }
    .tooltip { position:absolute; background:rgba(0,0,0,.8); color:#fff; padding:5px 10px; border-radius:4px; font-size:12px; opacity:0; transition:opacity .3s; pointer-events:none; white-space:nowrap; z-index:10; }
    .tooltip.show { opacity:1; }
  </style>
</head>
<body>
  <div class="container mx-auto px-4 py-8 relative overflow-hidden">
    <!-- Decorations -->
    <div class="paw-print text-6xl top-10 left-10">üêæ</div>
    <div class="paw-print text-8xl bottom-20 right-10">üêæ</div>
    <div class="paw-print text-5xl top-40 right-40">üêæ</div>
    <div class="paw-print text-7xl bottom-40 left-40">üêæ</div>

    <!-- Title -->
    <div class="text-center mb-8 relative z-10">
      <h1 class="text-4xl md:text-5xl font-bold text-[#54b8b2] mb-2">Doggy Desserts</h1>
      <h2 class="text-2xl md:text-3xl font-semibold text-[#ab5896] mb-4">Monthly Dog Photo Competition</h2>
      <p class="text-lg text-gray-700 max-w-2xl mx-auto">Vote for your favorite doggy! Each person can vote once per dog.</p>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="admin-panel relative z-10">
      <h3 class="text-2xl font-bold text-[#54b8b2] mb-4">Admin Panel</h3>
      <button id="logout-btn" class="logout-btn">Logout</button>
      <div class="mb-6">
        <h4 class="text-lg font-semibold mb-2">Add New Dog</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Dog Name</label>
            <input type="text" id="new-dog-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#54b8b2]" placeholder="Enter dog name">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
            <input type="text" id="new-dog-image" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#54b8b2]" placeholder="Paste image URL">
          </div>
          <div class="flex items-end">
            <button id="add-dog-btn" class="bg-[#54b8b2] text-white px-4 py-2 rounded-md hover:bg-[#48a19b]">Add Dog</button>
          </div>
        </div>
        <p class="mt-2 text-sm text-gray-600">To add a dog: upload image to Wix ‚Üí copy URL ‚Üí paste here</p>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-2">Manage Dogs</h4>
        <div id="dog-entries-list" class="max-h-60 overflow-y-auto border border-gray-200 rounded-md"></div>
      </div>
      <div class="mt-6 flex justify-between">
        <button id="save-data-btn" class="bg-[#54b8b2] text-white px-4 py-2 rounded-md hover:bg-[#48a19b]">Save Changes</button>
        <button id="reset-votes-btn" class="bg-[#ab5896] text-white px-4 py-2 rounded-md hover:bg-[#964c84]">Reset All Votes</button>
      </div>
    </div>

    <!-- Controls -->
    <div class="flex justify-between items-center mb-6 relative z-10">
      <div class="text-lg font-semibold text-[#ab5896]">
        <span id="total-entries">0</span> Entries
      </div>
      <div class="flex items-center">
        <label for="sort-select" class="mr-2 text-gray-700">Sort by:</label>
        <select id="sort-select" class="bg-white border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-[#54b8b2]">
          <option value="name">Name (A-Z)</option>
          <option value="votes">Most Votes</option>
          <option value="newest">Newest First</option>
        </select>
      </div>
    </div>

    <!-- Gallery -->
    <div id="dog-gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 relative z-10"></div>
  </div>

  <!-- Admin toggle & login -->
  <button id="admin-toggle" class="admin-toggle" style="display:none">‚öôÔ∏è</button>
  <div id="login-overlay" class="login-overlay">
    <div class="login-panel">
      <h3 class="text-2xl font-bold text-[#54b8b2] mb-4">Admin Login</h3>
      <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
      <input type="password" id="admin-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#54b8b2]" placeholder="Enter admin password">
      <div class="mt-4 flex justify-between">
        <button id="login-btn" class="bg-[#54b8b2] text-white px-4 py-2 rounded-md hover:bg-[#48a19b]">Login</button>
        <button id="cancel-login-btn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // ** 1) Public CSV URL from your published sheet **
    const sheetUrl =
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vT6MBX0N8yqU5Jz5H4W3G5EnYuBJm7XKy3YLXvWVtxXQLploHlcU-3VuHjjfjboZC2nzuelzieNuLSH/pub?gid=0&single=true&output=csv';

    // ** 2) Your Apps Script POST endpoint URL **
    const voteEndpoint =
      'https://script.google.com/macros/s/AKfycbwHrvAKb4o9GSIP84yBqd2q1MxDBJT0cT5Sf7SV5tIl1VempJqs6BjCjg5zb_DC3PG7aA/exec';

    async function fetchDogDataFromSheet() {
      const res = await fetch(sheetUrl);
      if (!res.ok) throw new Error('Could not load sheet CSV');
      const text = await res.text();
      const rows = text.trim().split('\n').slice(1);
      return rows.map(r => {
        const [id, name, votes, date, image] = r.split(',');
        return { id: +id, name: name.trim(), votes: +votes, date: date.trim(), image: image.trim() };
      });
    }

    function hasVoted(id) {
      return localStorage.getItem('voted_' + id) === 'true';
    }

    async function postVote(id) {
      await fetch(voteEndpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id })
      });
      localStorage.setItem('voted_' + id, 'true');
    }

    function createHeartAnimation(x, y) {
      const heart = document.createElement('div');
      heart.innerText = '‚ù§Ô∏è';
      heart.className = 'heart-animation text-2xl';
      heart.style.left = x + 'px';
      heart.style.top = y + 'px';
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 1000);
    }

    function renderDogs(dogs) {
      const gallery = document.getElementById('dog-gallery');
      gallery.innerHTML = '';
      dogs.forEach(d => {
        const voted = hasVoted(d.id);
        const card = document.createElement('div');
        card.className = 'dog-card bg-white rounded-lg shadow-md relative';
        card.innerHTML = `
          <img src="${d.image}" alt="${d.name}" class="w-full h-48 object-cover">
          <div class="p-4">
            <div class="flex justify-between items-center">
              <h3 class="text-xl font-bold">${d.name}</h3>
              <button class="share-btn" data-id="${d.id}" data-name="${d.name}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/>
                </svg>Share
              </button>
            </div>
            <div class="flex items-center mt-2">
              <button class="heart-btn mr-2 text-2xl ${voted ? 'voted' : ''}" ${voted ? 'disabled' : ''}>
                ${voted ? '‚ù§Ô∏è' : 'ü§ç'}
              </button>
              <span class="vote-count font-semibold text-lg">${d.votes}</span>
              <span class="ml-1 text-gray-600">votes</span>
            </div>
          </div>
        `;
        gallery.appendChild(card);

        // vote handler
        const btn = card.querySelector('.heart-btn');
        const count = card.querySelector('.vote-count');
        btn.addEventListener('click', async () => {
          if (!hasVoted(d.id)) {
            await postVote(d.id);
            btn.classList.add('voted');
            btn.disabled = true;
            count.textContent = d.votes + 1;
            createHeartAnimation(btn.getBoundingClientRect().left + 16, btn.getBoundingClientRect().top + 16);
          }
        });

        // share handler
        card.querySelector('.share-btn').addEventListener('click', e => {
          const url = window.location.href.split('?')[0] + '?dog=' + d.id;
          navigator.clipboard.writeText(url);
          const tooltip = document.createElement('div');
          tooltip.className = 'tooltip';
          tooltip.innerText = 'Link copied!';
          document.body.appendChild(tooltip);
          const rect = e.target.getBoundingClientRect();
          tooltip.style.top = rect.top - 30 + 'px';
          tooltip.style.left = rect.left + 'px';
          requestAnimationFrame(() => tooltip.classList.add('show'));
          setTimeout(() => tooltip.remove(), 2000);
        });
      });

      // scroll-to-dog if in URL
      const params = new URLSearchParams(location.search);
      const highlight = params.get('dog');
      if (highlight) {
        setTimeout(() => {
          const cards = document.querySelectorAll('.dog-card');
          const idx = dogs.findIndex(d => d.id.toString() === highlight);
          if (idx > -1) {
            cards[idx].scrollIntoView({ behavior: 'smooth', block: 'center' });
            cards[idx].classList.add('ring-4', 'ring-[#54b8b2]');
            setTimeout(() => cards[idx].classList.remove('ring-4', 'ring-[#54b8b2]'), 2000);
          }
        }, 500);
      }
    }

    function sortDogs(by) {
      fetchDogDataFromSheet().then(all => {
        let sorted = [...all];
        if (by === 'name') sorted.sort((a,b)=>a.name.localeCompare(b.name));
        if (by === 'votes') sorted.sort((a,b)=>b.votes - a.votes);
        if (by === 'newest') sorted.sort((a,b)=>new Date(b.date) - new Date(a.date));
        document.getElementById('total-entries').textContent = sorted.length;
        renderDogs(sorted);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      // init
      sortDogs('name');
      document.getElementById('sort-select').addEventListener('change', e => sortDogs(e.target.value));

      // admin login toggles
      document.getElementById('admin-toggle').addEventListener('click', () => {
        const p = document.getElementById('admin-panel');
        p.style.display = p.style.display==='block' ? 'none' : 'block';
      });
      document.addEventListener('keydown', e => {
        if (e.ctrlKey && e.shiftKey && e.key==='A') {
          document.getElementById('login-overlay').style.display = 'flex';
          document.getElementById('admin-password').focus();
        }
      });
      document.getElementById('login-btn').addEventListener('click', () => {
        if (document.getElementById('admin-password').value==='788220Lee!') {
          localStorage.setItem('isAdmin','true');
          document.getElementById('login-overlay').style.display='none';
          document.getElementById('admin-toggle').style.display='flex';
        } else alert('Wrong password');
      });
      document.getElementById('cancel-login-btn').addEventListener('click', () => {
        document.getElementById('login-overlay').style.display='none';
      });
      if (localStorage.getItem('isAdmin')==='true') {
        document.getElementById('admin-toggle').style.display='flex';
      }
      document.getElementById('logout-btn').addEventListener('click', () => {
        localStorage.removeItem('isAdmin');
        document.getElementById('admin-panel').style.display='none';
        document.getElementById('admin-toggle').style.display='none';
        alert('Logged out');
      });
      // add/manage/reset admin functions
      document.getElementById('add-dog-btn').addEventListener('click', () => {
        alert('Use your Google Sheet to add new rows; changes show live on reload.');
      });
      document.getElementById('reset-votes-btn').addEventListener('click', () => {
        if (confirm('Reset votes in sheet?')) {
          alert('Please reset votes manually in your Google Sheet.');
        }
      });
    });
  </script>
</body>
</html>
