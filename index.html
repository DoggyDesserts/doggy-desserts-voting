<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doggy Desserts - Monthly Competition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
    :root {
      --primary: #54b8b2;
      --secondary: #ab5896;
      --accent: #c0d969;
      --light: #f9f9f9;
      --dark: #333333;
    }
    body { font-family: 'Nunito', sans-serif; background: var(--light); }
    .dog-card { transition: all .3s ease; border:2px solid #f1f1f1; overflow:hidden; }
    .dog-card:hover { transform: translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,0.1); }
    .heart-btn { transition: all .2s ease; cursor:pointer; }
    .heart-btn:hover:not(.voted) { transform: scale(1.1); }
    .heart-btn.voted { color: var(--secondary); animation: heartBeat .3s ease-in-out; }
    @keyframes heartBeat {
      0%{transform:scale(1)}25%{transform:scale(1.3)}50%{transform:scale(1)}75%{transform:scale(1.2)}100%{transform:scale(1)}
    }
    .heart-animation { position:absolute; pointer-events:none; animation:floatUp 1s ease-out forwards; opacity:0;}
    @keyframes floatUp {0%{transform:translateY(0) scale(.5);opacity:1}100%{transform:translateY(-50px) scale(1.5);opacity:0}}
    .vote-count.bump { animation: bump .3s ease; }
    @keyframes bump {0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
    .paw-print { position:absolute; opacity:.05; z-index:0; }
    .admin-panel { display:none; background:white; border:2px solid var(--primary); border-radius:8px;
                   padding:20px; margin-bottom:30px; box-shadow:0 5px 15px rgba(0,0,0,0.1); position:relative; }
    .admin-toggle { position:fixed; bottom:20px; right:20px; z-index:100; background:var(--primary);
                    color:white; border:none; border-radius:50%; width:50px; height:50px;
                    font-size:24px; display:flex; align-items:center; justify-content:center;
                    cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.2); }
    .login-overlay { position:fixed; top:0;left:0;right:0;bottom:0;
                     background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:1000; }
    .login-panel { background:white; padding:30px; border-radius:8px; width:90%; max-width:400px;
                   box-shadow:0 5px 20px rgba(0,0,0,0.2); }
    .tooltip { position:absolute; background:rgba(0,0,0,.8); color:white; padding:5px 10px;
               border-radius:4px; font-size:12px; opacity:0; transition:opacity .3s; pointer-events:none; z-index:10; }
    .tooltip.show { opacity:1; }
  </style>
</head>
<body>
  <div class="container mx-auto px-4 py-8 relative overflow-hidden">
    <!-- paw prints -->
    <div class="paw-print text-6xl top-10 left-10">üêæ</div>
    <div class="paw-print text-8xl bottom-20 right-10">üêæ</div>
    <div class="paw-print text-5xl top-40 right-40">üêæ</div>
    <div class="paw-print text-7xl bottom-40 left-40">üêæ</div>

    <div class="text-center mb-8 relative z-10">
      <h1 class="text-4xl md:text-5xl font-bold text-[#54b8b2] mb-2">Doggy Desserts</h1>
      <h2 class="text-2xl md:text-3xl font-semibold text-[#ab5896] mb-4">Monthly Dog Photo Competition</h2>
      <p class="text-lg text-gray-700 max-w-2xl mx-auto">
        Vote for your favorite doggy! Each person can vote once per dog.
      </p>
    </div>

    <!-- Top controls -->
    <div class="flex justify-between items-center mb-6 relative z-10">
      <div class="text-lg font-semibold text-[#ab5896]"><span id="total-entries">0</span> Entries</div>
      <div class="flex items-center">
        <label for="sort-select" class="mr-2 text-gray-700">Sort by:</label>
        <select id="sort-select"
                class="bg-white border border-gray-300 rounded-md px-3 py-1 focus:ring-2 focus:ring-[#54b8b2]">
          <option value="name">Name (A‚ÄìZ)</option>
          <option value="votes">Most Votes</option>
          <option value="newest">Newest First</option>
        </select>
      </div>
    </div>

    <!-- Gallery -->
    <div id="dog-gallery"
         class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 relative z-10">
      <!-- cards injected here -->
    </div>

    <!-- admin toggle & login (omit if you‚Äôre not using admin) -->
    <button id="admin-toggle" class="admin-toggle" style="display:none">‚öôÔ∏è</button>
    <div id="login-overlay" class="login-overlay" style="display:none">
      <div class="login-panel">
        <h3 class="text-2xl font-bold text-[#54b8b2] mb-4">Admin Login</h3>
        <label class="block text-sm text-gray-700 mb-1">Password</label>
        <input id="admin-password" type="password"
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#54b8b2]"
               placeholder="Enter password" />
        <div class="mt-4 flex justify-between">
          <button id="login-btn" class="bg-[#54b8b2] text-white px-4 py-2 rounded-md hover:bg-[#48a19b]">Login</button>
          <button id="cancel-login-btn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const sheetUrl = 
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vT6MBX0N8yqU5Jz5H4W3G5EnYuBJm7XKy3YLXvWVtxXQLploHlcU-3VuHjjfjboZC2nzuelzieNuLSH/pub?gid=0&single=true&output=csv';
    const voteEndpoint = 
      'https://script.google.com/macros/s/AKfycbwHrvAKb4o9GSIP84yBqd2q1MxDBJT0cT5Sf7SV5tIl1VempJqs6BjCjg5zb_DC3PG7aA/exec';

    const KEY = 'v2_voted_';   // bump this if you ever need a fresh start

    // ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function createHeartAnimation(x,y){
      const h = document.createElement('div');
      h.innerText='‚ù§Ô∏è'; h.className='heart-animation text-2xl';
      h.style.left=`${x}px`; h.style.top=`${y}px`;
      document.body.appendChild(h);
      setTimeout(()=>h.remove(),1000);
    }
    function showTooltip(el,msg){
      document.querySelectorAll('.tooltip').forEach(t=>t.remove());
      const tip=document.createElement('div');
      tip.className='tooltip'; tip.innerText=msg;
      const r=el.getBoundingClientRect();
      tip.style.top=`${r.top-30}px`; tip.style.left=`${r.left+r.width/2-40}px`;
      document.body.appendChild(tip);
      requestAnimationFrame(()=>tip.classList.add('show'));
      setTimeout(()=>{ tip.classList.remove('show'); setTimeout(()=>tip.remove(),300); },2000);
    }

    function hasVoted(id){ return localStorage.getItem(KEY+id)==='true'; }
    async function postVote(id){
      await fetch(voteEndpoint,{
        method:'POST',
        body: JSON.stringify({id})
      });
      localStorage.setItem(KEY+id,'true');
    }

    async function fetchDogData(){
      const res=await fetch(sheetUrl);
      if(!res.ok) throw 'CSV load failed';
      const text=await res.text();
      return text.trim().split('\n').slice(1).map(r=>{
        const [id,name,votes,date,image]=r.split(',');
        return {id:+id,name:name.trim(),votes:+votes,date:date.trim(),image:image.trim()};
      });
    }

    function renderDogs(dogs){
      const g=document.getElementById('dog-gallery');
      g.innerHTML='';
      dogs.forEach(d=>{
        const voted=hasVoted(d.id);
        const card=document.createElement('div');
        card.className='dog-card bg-white rounded-lg shadow-md relative';
        card.innerHTML=`
          <div class="h-48 overflow-hidden">
            <img src="${d.image}" alt="${d.name}" class="w-full h-full object-cover"/>
          </div>
          <div class="p-4 flex justify-between items-center">
            <h3 class="text-xl font-bold text-gray-800">${d.name}</h3>
            <button class="share-btn text-gray-700 bg-gray-100 px-2 py-1 rounded-md">Share</button>
          </div>
          <div class="px-4 pb-4 flex items-center">
            <button class="heart-btn text-2xl mr-2 ${voted?'voted':''}" ${voted?'disabled':''}>
              ${voted?'‚ù§Ô∏è':'ü§ç'}
            </button>
            <span class="vote-count font-semibold text-lg">${d.votes}</span>
            <span class="ml-1 text-gray-600">votes</span>
          </div>
        `;
        g.appendChild(card);

        const heart=card.querySelector('.heart-btn');
        const count=card.querySelector('.vote-count');
        heart.onclick = () => {
          if(heart.disabled) return;
          heart.classList.add('voted');
          heart.disabled=true;
          d.votes++; count.textContent=d.votes;
          count.classList.add('bump');
          setTimeout(()=>count.classList.remove('bump'),300);
          const r=heart.getBoundingClientRect();
          createHeartAnimation(r.left+r.width/2, r.top+r.height/2);
          postVote(d.id).catch(console.error);
        };

        const share=card.querySelector('.share-btn');
        share.onclick=()=>{
          navigator.clipboard.writeText(`${location.origin+location.pathname}?dog=${d.id}`);
          showTooltip(share,'Link copied!');
        };
      });
    }

    function sortDogs(arr,by){
      if(by==='name')    arr.sort((a,b)=>a.name.localeCompare(b.name));
      if(by==='votes')   arr.sort((a,b)=>b.votes - a.votes);
      if(by==='newest')  arr.sort((a,b)=>new Date(b.date)-new Date(a.date));
    }

    async function init(){
      const dogs = await fetchDogData();
      document.getElementById('total-entries').textContent = dogs.length;
      const sel = document.getElementById('sort-select');
      sel.onchange = ()=>{
        sortDogs(dogs, sel.value);
        renderDogs(dogs);
      };
      sortDogs(dogs, sel.value);
      renderDogs(dogs);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
