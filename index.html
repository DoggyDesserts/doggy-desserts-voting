<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Doggy Desserts - Monthly Competition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
    :root {
      --primary: #54b8b2;
      --secondary: #ab5896;
      --accent: #c0d969;
      --light: #f9f9f9;
      --dark: #333;
    }
    body {
      font-family: 'Nunito',sans-serif;
      background-color: var(--light);
    }
    .dog-card { transition: all .3s ease; overflow: hidden; border: 2px solid #f1f1f1; }
    .dog-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,.1); }
    .heart-btn { transition: all .2s ease; }
    .heart-btn:hover:not(.voted) { transform: scale(1.1); }
    .heart-btn.voted { color: var(--secondary); animation: heartBeat .3s ease-in-out; }
    @keyframes heartBeat { 0%{transform:scale(1)}25%{transform:scale(1.3)}50%{transform:scale(1)}75%{transform:scale(1.2)}100%{transform:scale(1)} }
    .heart-animation { position:absolute; pointer-events:none; animation: floatUp 1s ease-out forwards; opacity:0; }
    @keyframes floatUp { 0%{transform:translateY(0) scale(.5);opacity:1}100%{transform:translateY(-50px) scale(1.5);opacity:0} }
    .vote-count { transition: all .3s ease; }
    .vote-count.bump { animation: bump .3s ease; }
    @keyframes bump { 0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)} }
    .paw-print { position:absolute; opacity:.05; z-index:0; }
    .admin-panel { display:none; background:#fff; border:2px solid var(--primary); border-radius:8px; padding:20px; margin-bottom:30px; box-shadow:0 5px 15px rgba(0,0,0,.1); position:relative; }
    .admin-toggle { position:fixed; bottom:20px; right:20px; z-index:100; background:var(--primary); color:#fff; border:none; border-radius:50%; width:50px; height:50px; font-size:24px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,.2); }
    .dog-entry { display:flex; align-items:center; padding:10px; border-bottom:1px solid #eee; }
    .dog-entry:last-child { border-bottom:none; }
    .login-overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:1000; }
    .login-panel { background:#fff; padding:30px; border-radius:8px; width:90%; max-width:400px; box-shadow:0 5px 20px rgba(0,0,0,.2); }
    .logout-btn, .share-btn { transition: all .2s ease; }
    .logout-btn { position:absolute; top:20px; right:20px; background:#f3f4f6; color:#4b5563; border:1px solid #e5e7eb; border-radius:4px; padding:6px 12px; font-size:14px; cursor:pointer; }
    .logout-btn:hover { background:#e5e7eb; }
    .share-btn { display:flex; align-items:center; padding:5px 10px; background:#f3f4f6; border-radius:4px; color:#4b5563; font-size:14px; cursor:pointer; }
    .share-btn:hover { background:#e5e7eb; }
    .share-btn svg { margin-right:5px; }
    .tooltip { position:absolute; background:rgba(0,0,0,.8); color:#fff; padding:5px 10px; border-radius:4px; font-size:12px; opacity:0; transition:opacity .3s; pointer-events:none; white-space:nowrap; z-index:10; }
    .tooltip.show { opacity:1; }
  </style>

  <!-- your Apps Script endpoint -->
  <script>
    const VOTE_URL = 'https://script.google.com/macros/s/AKfycbwHrvAKb4o9GSIP84yBqd2q1MxDBJT0cT5Sf7SV5tIl1VempJqs6BjCjg5zb_DC3PG7aA/exec';
  </script>
</head>
<body>
  <div class="container mx-auto px-4 py-8 relative overflow-hidden">
    <div class="paw-print text-6xl top-10 left-10">üêæ</div>
    <div class="paw-print text-8xl bottom-20 right-10">üêæ</div>
    <div class="paw-print text-5xl top-40 right-40">üêæ</div>
    <div class="paw-print text-7xl bottom-40 left-40">üêæ</div>

    <div class="text-center mb-8 relative z-10">
      <h1 class="text-4xl md:text-5xl font-bold text-[#54b8b2] mb-2">Doggy Desserts</h1>
      <h2 class="text-2xl md:text-3xl font-semibold text-[#ab5896] mb-4">Monthly Dog Photo Competition</h2>
      <p class="text-lg text-gray-700 max-w-2xl mx-auto">
        Vote for your favorite doggy! Each person can vote once per dog.
      </p>
    </div>

    <!-- admin panel here if you still need it -->

    <div class="flex justify-between items-center mb-6 relative z-10">
      <div class="text-lg font-semibold text-[#ab5896]">
        <span id="total-entries">0</span> Adorable Doggy's
      </div>
      <div class="flex items-center">
        <label for="sort-select" class="mr-2 text-gray-700">Sort by:</label>
        <select id="sort-select" class="bg-white border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-[#54b8b2]">
          <option value="name">Name (A-Z)</option>
          <option value="votes">Most Votes</option>
          <option value="newest">Newest First</option>
        </select>
      </div>
    </div>

    <div id="dog-gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 relative z-10"></div>
  </div>

  <script>
    // helpers
    function updateTotalEntries() {
      document.getElementById('total-entries').textContent = (window.liveDogData||[]).length;
    }
    function floatHeart(x,y) {
      const h=document.createElement('div');
      h.innerHTML='‚ù§Ô∏è'; h.className='heart-animation text-2xl';
      h.style.left=`${x}px`; h.style.top=`${y}px`;
      document.body.appendChild(h);
      setTimeout(()=>h.remove(),1000);
    }

    // vote POSTs to your Apps Script
    function handleVote(id, btn, countEl) {
      if(btn.disabled) return;
      btn.disabled = true;
      fetch(VOTE_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({ id })
      })
      .then(r=>r.json())
      .then(data=>{
        if(data.success){
          countEl.textContent = data.newVotes;
          btn.classList.add('voted');
          const rect=btn.getBoundingClientRect();
          floatHeart(rect.left+rect.width/2, rect.top+rect.height/2);
        } else {
          alert('Error: '+data.message);
          btn.disabled = false;
        }
      })
      .catch(()=>{
        alert('Network error');
        btn.disabled = false;
      });
    }

    // render cards
    function renderDogs(arr){
      const g=document.getElementById('dog-gallery');
      g.innerHTML='';
      arr.forEach(dog=>{
        const card=document.createElement('div');
        card.className='dog-card bg-white rounded-lg overflow-hidden shadow-md relative';
        card.innerHTML=`
          <div class="h-48 overflow-hidden"><img src="${dog.image}" alt="${dog.name}" class="w-full h-full object-cover"></div>
          <div class="p-4">
            <div class="flex justify-between items-center">
              <h3 class="text-xl font-bold">${dog.name}</h3>
              <button class="share-btn">Share</button>
            </div>
            <div class="flex items-center mt-2">
              <button class="heart-btn mr-2 text-2xl focus:outline-none">${'ü§ç'}</button>
              <span class="vote-count font-semibold text-lg">${dog.votes}</span>
              <span class="ml-1 text-gray-600">votes</span>
            </div>
          </div>`;
        g.appendChild(card);
        const heart = card.querySelector('.heart-btn');
        const count = card.querySelector('.vote-count');
        heart.addEventListener('click', ()=>handleVote(dog.id, heart, count));
      });
    }

    // sort
    function sortDogs(by){
      const arr=(window.liveDogData||[]).slice();
      if(by==='name') arr.sort((a,b)=>a.name.localeCompare(b.name));
      if(by==='votes') arr.sort((a,b)=>b.votes-a.votes);
      if(by==='newest') arr.sort((a,b)=>new Date(b.date)-new Date(a.date));
      renderDogs(arr);
    }

    // load CSV from Sheet, parse & kick off
    async function init(){
      const res = await fetch(VOTE_URL+'?output=csv');
      const text = await res.text();
      const rows=text.trim().split('\n').slice(1);
      window.liveDogData = rows.map(r=>{
        const [id,name,votes,date,image] = r.split(',');
        return { id:+id, name, votes:+votes, date, image };
      });
      updateTotalEntries();
      sortDogs('name');
      document.getElementById('sort-select').onchange = e=>sortDogs(e.target.value);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
