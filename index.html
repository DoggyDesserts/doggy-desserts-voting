<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doggy Desserts Voting</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    html {
      scroll-behavior: smooth;
      font-family: 'Poppins', sans-serif;
    }
    body {
      margin: 0;
      background: #fdfaf6;
    }
    header {
      background: #25b3ad;
      colour: white;
      padding: 2rem;
      text-align: centre;
      font-size: 1.8rem;
      font-weight: 600;
    }
    .container {
      background: #fffdf9;
      margin: 2rem auto;
      padding: 1.5rem;
      border-radius: 20px;
      max-width: 900px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .dog-card {
      margin: 1.2rem 0;
      padding: 1rem;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      display: flex;
      align-items: centre;
      gap: 1rem;
    }
    .dog-card img {
      max-width: 100px;
      height: auto;
      border-radius: 12px;
    }
    .dog-name {
      font-size: 1.2rem;
      font-weight: 600;
    }
    .vote-btn {
      margin-left: auto;
      background: #25b3ad;
      colour: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 30px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .vote-btn:hover {
      transform: scale(1.05);
    }
    .highlight {
      animation: pulse 1s ease-out;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0px #25b3ad; }
      50% { box-shadow: 0 0 20px #25b3ad; }
      100% { box-shadow: 0 0 0px #25b3ad; }
    }
  </style>
</head>
<body>
  <header>
    Doggy Desserts Monthly Dog Photo Competition<br>
    <span style="font-size:1rem; font-weight:400;">Voting is open until 7th June – cast your votes below!</span>
  </header>

  <div class="container" id="vote-container">
    <!-- Dog cards will load here -->
  </div>

  <script>
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT6MBX0N8yqU5Jz5H4W3G5EnYuBJm7XKy3YLXvWVtxXQLploHlcU-3VuHjjfjboZC2nzuelzieNuLSH/pub?output=csv';
    const submitURL = 'https://script.google.com/macros/s/AKfycbzXjE7HeeWUshnrBxJCHDdgeiO29ovYJLUfH7bSr-bldkc95cskvCAlszKEQEwTju2T/exec';

    const voted = JSON.parse(localStorage.getItem("votedDogs") || "[]");

    function createCard(name, image, votes) {
      const id = name.toLowerCase().replace(/[^a-z0-9]+/g, "-");
      const card = document.createElement("div");
      card.className = "dog-card";
      card.id = id;

      const img = document.createElement("img");
      img.src = image;
      img.alt = name;

      const title = document.createElement("div");
      title.className = "dog-name";
      title.textContent = name;

      const voteBtn = document.createElement("button");
      voteBtn.className = "vote-btn";
      voteBtn.textContent = voted.includes(name) ? "✓ Voted" : "Vote";

      if (!voted.includes(name)) {
        voteBtn.onclick = () => {
          fetch(submitURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name })
          }).then(res => {
            if (res.ok) {
              voted.push(name);
              localStorage.setItem("votedDogs", JSON.stringify(voted));
              voteBtn.textContent = "✓ Voted";
              voteBtn.disabled = true;
            }
          });
        };
      } else {
        voteBtn.disabled = true;
      }

      card.appendChild(img);
      card.appendChild(title);
      card.appendChild(voteBtn);
      return card;
    }

    fetch(sheetURL)
      .then(res => res.text())
      .then(text => {
        const rows = text.trim().split("\n").slice(1);
        const container = document.getElementById("vote-container");
        rows.forEach(row => {
          const [id, name, , , image] = row.split(",");
          container.appendChild(createCard(name.trim(), image.trim()));
        });

        // Scroll to dog if hash exists
        const hash = window.location.hash;
        if (hash) {
          const target = document.querySelector(hash);
          if (target) {
            target.scrollIntoView({ behavior: "smooth", block: "center" });
            target.classList.add("highlight");
            setTimeout(() => target.classList.remove("highlight"), 1500);
          }
        }
      });
  </script>
</body>
</html>
